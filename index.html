<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Torneo Wilson | El Rinc√≥n del P√°del</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: #f9f9f9;
      color: #333;
    }
    header {
      background-color: #1D9BF0;
      color: white;
      padding: 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    h1 { margin: 0; font-size: 1.5rem; }
    .tabs {
      display: flex;
      justify-content: center;
      background: #e6f2fb;
      border-bottom: 2px solid #1D9BF0;
    }
    .tabs button {
      background: none;
      border: none;
      padding: 1rem 2rem;
      cursor: pointer;
      font-weight: bold;
      color: #1D9BF0;
    }
    .tabs button.active {
      border-bottom: 4px solid #1D9BF0;
      color: #0b4d91;
    }
    .content { padding: 1rem 2rem; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th { background-color: #1D9BF0; color: white; }
    .hidden { display: none; }
    .btn-generar {
      padding: 1rem 2rem;
      font-size: 1rem;
      background-color: #1D9BF0;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 2rem;
    }
  </style>
</head>
<body>

<header>
  <h1>Torneo Wilson | El Rinc√≥n del P√°del</h1>
</header>

<div class="tabs">
  <button class="tab-button active" data-group="A">Grupo A</button>
  <button class="tab-button" data-group="B">Grupo B</button>
  <button class="tab-button" data-group="C">Grupo C</button>
  <button class="tab-button" data-group="D">Grupo D</button>
  <button class="tab-button" data-group="Eliminatorias">Eliminatorias</button>
</div>

<div class="content">
  <div id="grupo-content"></div>
</div>

<script>
  const url = "https://script.google.com/macros/s/AKfycbyzqUYL4ZttcbVDwuL7nhLmoFDLim3TpsL6Bc21GyKXVVkto5Ayq39qdTmTfXKArGpl/exec";
  const grupoContent = document.getElementById("grupo-content");
  const tabs = document.querySelectorAll(".tab-button");
  let datosGlobal = {};

  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      tabs.forEach(t => t.classList.remove("active"));
      tab.classList.add("active");
      const grupo = tab.dataset.group;
      mostrarGrupo(grupo);
    });
  });

  fetch(url)
    .then(res => res.json())
    .then(data => {
      datosGlobal = data;
      mostrarGrupo("A");
    });

  function mostrarGrupo(grupo) {
    if (grupo === "Eliminatorias") {
      const eliminatorias = datosGlobal["eliminatorias"] || [];

      const tablaFiltrada = (rondas) => eliminatorias
        .filter(p => rondas.includes(p["Ronda"]))
        .map(p => `
          <tr>
            <td>${p["Ronda"] || ''}</td>
            <td>${p["Pareja 1"] || ''}</td>
            <td>${p["Pareja 2"] || ''}</td>
            <td>${p["Resultado"] || ''}</td>
            <td>${p["Ganador"] || ''}</td>
          </tr>`).join('');

      grupoContent.innerHTML = `
        <h2>Cuadro Eliminatorias</h2>

        <h3>Semifinales</h3>
        <table>
          <thead>
            <tr><th>Ronda</th><th>Pareja 1</th><th>Pareja 2</th><th>Resultado</th><th>Ganador</th></tr>
          </thead>
          <tbody>
            ${tablaFiltrada(["Semifinal 1", "Semifinal 2"])}
          </tbody>
        </table>

        <h3>Final</h3>
        <table>
          <thead>
            <tr><th>Ronda</th><th>Pareja 1</th><th>Pareja 2</th><th>Resultado</th><th>Ganador</th></tr>
          </thead>
          <tbody>
            ${tablaFiltrada(["Final"])}
          </tbody>
        </table>

        <h3>Consolaci√≥n</h3>
        <table>
          <thead>
            <tr><th>Ronda</th><th>Pareja 1</th><th>Pareja 2</th><th>Resultado</th><th>Ganador</th></tr>
          </thead>
          <tbody>
            ${tablaFiltrada(["Semifinal Consolaci√≥n 1", "Semifinal Consolaci√≥n 2", "Final Consolaci√≥n"])}
          </tbody>
        </table>

        <div style="text-align:center;">
          <button class="btn-generar" onclick="generarEliminatoriasDesdeHTML()">
            üîÅ Generar Cuadro de Eliminatorias
          </button>
          <p style="margin-top: 0.5rem; color: #777;">Pulsa solo si ya han finalizado todos los partidos de grupo.</p>
        </div>
      `;
      return;
    }

    const resultados = datosGlobal["resultados" + grupo] || [];
    const clasificacion = datosGlobal["clasificacion" + grupo] || [];

    grupoContent.innerHTML = `
      <h2>Resultados - Grupo ${grupo}</h2>
      <table>
        <thead>
          <tr><th>Pareja 1</th><th>Pareja 2</th><th>Resultado</th><th>Ganador</th></tr>
        </thead>
        <tbody>
          ${resultados.map(p => `
            <tr>
              <td>${p['Pareja 1'] || ''}</td>
              <td>${p['Pareja 2'] || ''}</td>
              <td>${p['Resultado'] || ''}</td>
              <td>${p['Ganador'] || ''}</td>
            </tr>`).join('')}
        </tbody>
      </table>

      <h2>Clasificaci√≥n - Grupo ${grupo}</h2>
      <table>
        <thead>
          <tr>
            <th>Pareja</th><th>PJ</th><th>PG</th><th>Juegos Ganados</th><th>Juegos Perdidos</th><th>Diferencia</th>
          </tr>
        </thead>
        <tbody>
          ${clasificacion.sort((a, b) =>
            b["PG"] - a["PG"] ||
            b["Juegos Ganados"] - a["Juegos Ganados"] ||
            b["Diferencia"] - a["Diferencia"]
          ).map(p => `
            <tr>
              <td>${p['Pareja'] || ''}</td>
              <td>${p['PJ'] || 0}</td>
              <td>${p['PG'] || 0}</td>
              <td>${p['Juegos Ganados'] || 0}</td>
              <td>${p['Juegos Perdidos'] || 0}</td>
              <td>${p['Diferencia'] || 0}</td>
            </tr>`).join('')}
        </tbody>
      </table>
    `;
  }

  function generarEliminatoriasDesdeHTML() {
    const clave = prompt("Introduce el c√≥digo para generar el cuadro:");
    if (clave !== "admin2024") {
      alert("‚ùå C√≥digo incorrecto. No se ha generado el cuadro.");
      return;
    }

    fetch(url, {
      method: "POST",
      body: new URLSearchParams({ action: "generarEliminatorias" }),
      headers: { "Content-Type": "application/x-www-form-urlencoded" }
    })
    .then(res => res.text())
    .then(resp => {
      alert("‚úÖ Cuadro generado correctamente.");
      location.reload();
    })
    .catch(err => {
      alert("‚ùå Error al generar el cuadro.");
      console.error(err);
    });
  }
</script>

</body>
</html>

